OVERRIDE(KoreanURLShortener.LinkModel,function(t){"use strict";KoreanURLShortener.LinkModel=OBJECT({preset:function(){return t},init:function(t,n){var r=require("http"),e=require("https");t.on("create",{before:function(t,o,s){var i=t.url,u=0,c=function(){var r;100>u&&(u+=1,r=String.fromCharCode(RANDOM({min:44032,max:55203}))+String.fromCharCode(RANDOM({min:44032,max:55203})),n.checkIsExists({filter:{id:r}},function(n){n===!0?c():(t.id=r,o())}))};return"http://"!==i.substring(0,7)&&"https://"!==i.substring(0,8)&&(t.url=i="http://"+i),n.get({filter:{url:i}},{success:function(t){s({savedData:t})},notExists:function(){("http://"===i.substring(0,7)?r:e).get(i,function(t){"http://짧.한국"===i.substring(0,11)||200!==t.statusCode&&301!==t.statusCode&&302!==t.statusCode?s({validErrors:{url:{type:"wrongURL"}}}):c()}).on("error",function(){s({validErrors:{url:{type:"wrongURL"}}})})}}),!1}})}})}),KoreanURLShortener.MAIN=METHOD({run:function(t){"use strict";var n=require("child_process"),r=URI_MATCHER("{id}"),e=URI_MATCHER("__CAPTURE/{url}");t(function(t,o,s,i,u){var c,a,h=t.uri,d=r.check(h);return d.checkIsMatched()===!0?(KoreanURLShortener.LinkModel.update({id:decodeURIComponent(d.getURIParams().id),$inc:{count:1}},{notExists:function(){o({statusCode:302,headers:{Location:"http://"+encodeURIComponent("짧.한국")}})},success:function(t){o({statusCode:302,headers:{Location:t.url}})}}),!1):(c=e.check(h),c.checkIsMatched()===!0?(a=c.getURIParams().url,a=a.substring(0,a.length-4),CHECK_IS_EXISTS_FILE(NODE_CONFIG.rootPath+"/__CAPTURE/"+a+".png",function(t){var r;t===!0?(i(NODE_CONFIG.rootPath),u()):(r=n.spawn("phantomjs",[NODE_CONFIG.rootPath+"/screencapture.js",a]),r.on("error",function(){}),r.on("exit",function(){i(NODE_CONFIG.rootPath),u()}))}),!1):""!==h?(o({statusCode:302,headers:{Location:"http://"+encodeURIComponent("짧.한국")}}),!1):void 0)})}});